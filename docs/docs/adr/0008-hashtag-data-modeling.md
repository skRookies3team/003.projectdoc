# [ADR-0003] 검색 성능 최적화를 위한 해시태그 정규화 모델링

* **상태**: 승인됨 (Accepted) [2025-12-09]
* **결정자**: Social Service Team
* **관련 이슈**: [Feat#8] 해시태그 기능 구현

## 1. 배경 및 문제 (Context)
피드 본문(`content`)에 포함된 해시태그(#)를 추출하여 저장하고, 추후 특정 태그를 통한 피드 검색 기능을 제공해야 한다.
초기에는 `Feed` 테이블의 `content` 컬럼(TEXT)에 태그가 포함된 전체 문자열을 저장했다. 하지만 이 구조에서 검색을 수행하려면 `LIKE '%#태그명%'` 방식을 사용해야 하는데, 이는 인덱스를 타지 못하고(Full Table Scan) 검색 속도가 매우 느리다는 문제가 있다.

## 2. 결정 사항 (Decision)
우리는 **해시태그를 별도의 엔티티(`Hashtag`)로 분리하고, 피드와의 관계를 매핑 테이블(`FeedHashtag`)로 관리하는 정규화 전략**을 채택한다.
또한, 피드 생성/수정 시점에 애플리케이션 레벨(Service)에서 정규표현식을 통해 태그를 파싱하여 저장한다.

## 3. 결정 근거 (Decision Drivers)
* **검색 속도 보장**: 태그명(`name`) 컬럼에 인덱스를 걸어 `Exact Match` 검색이 가능해야 한다.
* **데이터 정합성**: 동일한 태그("강아지")는 DB 내에 단 하나만 존재해야 하며, 중복 저장을 방지해야 한다.
* **확장성**: 추후 '인기 태그 순위', '태그별 게시물 수' 등의 통계 기능을 구현하기 용이해야 한다.

## 4. 고려했던 대안들 (Considered Options)
* **[대안 1] RDB 정규화 테이블 구조 (Hashtag, FeedHashtag) (채택됨)**
* **[대안 2] 단일 컬럼 내 단순 문자열 저장**
    * 예: `tags` 컬럼에 "#강아지,#산책" 형태로 저장.
* **[대안 3] 별도 검색 엔진(Elasticsearch) 도입**
    * RDB는 저장만 하고, 검색 트래픽은 검색 엔진으로 위임.

## 5. 장단점 분석 (Pros and Cons)

### [RDB 정규화 테이블 구조] (채택됨)
* **장점**:
    * `JOIN` 쿼리를 통해 인덱스를 활용한 매우 빠른 검색 속도를 보장한다.
    * 데이터 중복이 제거되어 저장 공간을 효율적으로 사용한다.
* **단점**:
    * 피드 작성(Write) 시점에 파싱 및 다중 `INSERT`가 발생하여 쓰기 로직이 다소 복잡해진다.

### [단일 컬럼 내 단순 문자열 저장]
* **장점**: 구현이 매우 단순하고 쓰기 속도가 빠르다.
* **단점**: 검색 시 인덱스 활용이 불가능하여, 데이터가 쌓이면 서비스 불능 상태가 될 수 있다.

## 6. 결과 및 영향 (Consequences)
* **긍정적**: 향후 구현될 '해시태그 검색 API'에서 높은 성능을 기대할 수 있다.
* **부정적**: 피드 수정(`Update`) 시 기존 태그와 새로운 태그를 비교하여 삭제/추가하는 동기화 로직을 추가로 구현해야 한다.